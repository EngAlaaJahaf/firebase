<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>Ø±ÙÙŠÙ‚ÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</title>

    <!-- Firebase v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <style>
        * {
            box-sizing: border-box;
            font-family: "Segoe UI", Tahoma, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background: #f3f4f6;
            color: #111827;
        }

        .app-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }

        .card {
            background: #ffffff;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
        }

        .app-header {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 20px;
        }

        .app-title {
            font-size: 26px;
            font-weight: 700;
            color: #111827;
        }

        .app-subtitle {
            font-size: 14px;
            color: #6b7280;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            background: #eff6ff;
            color: #1d4ed8;
            margin-top: 6px;
        }

        .badge span.icon {
            font-size: 14px;
        }

        .form-section {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 16px;
        }

        .form-section input {
            flex: 1;
            min-width: 220px;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            outline: none;
            font-size: 14px;
        }

        .form-section input:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.15);
        }

        .btn {
            padding: 10px 18px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: 0.15s ease-in-out;
            white-space: nowrap;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-ghost {
            background: transparent;
            color: #6b7280;
        }

        .btn-ghost:hover {
            background: #f3f4f6;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .status-bar {
            margin-bottom: 12px;
            min-height: 20px;
            font-size: 13px;
            color: #6b7280;
        }

        .status-bar span.ok {
            color: #16a34a;
        }

        .status-bar span.error {
            color: #b91c1c;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            margin-top: 8px;
        }

        thead {
            background: #f9fafb;
        }

        th, td {
            padding: 10px 12px;
            text-align: right;
            border-bottom: 1px solid #e5e7eb;
        }

        th {
            font-weight: 600;
            color: #4b5563;
        }

        tr:hover td {
            background: #f9fafb;
        }

        .empty-state {
            text-align: center;
            padding: 24px 0 8px;
            font-size: 14px;
            color: #9ca3af;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 11px;
            background: #ecfdf5;
            color: #15803d;
        }

        .footer-note {
            margin-top: 18px;
            font-size: 12px;
            color: #9ca3af;
            text-align: left;
            direction: ltr;
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø³ÙŠØ·) */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.45);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 20px;
            width: 320px;
            max-width: 90%;
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.35);
        }

        .modal-header {
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 14px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="card">
            <header class="app-header">
                <div class="app-title">ğŸ“š Ø±ÙÙŠÙ‚ÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ â€“ Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</div>
                <div class="app-subtitle">
                    Ø£Ø¶ÙØŒ Ø¹Ø¯Ù‘Ù„ØŒ ÙˆØ§Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø³ÙŠØ·Ø© Ù…ØªØµÙ„Ø© Ø¨Ù€ Firebase Firestore.
                </div>
                <div class="badge">
                    <span class="icon">âš¡</span>
                    <span>Ù…ØªØµÙ„ Ø¨Ù€ Firebase â€“ ÙˆØ¶Ø¹ ØªØ¬Ø±ÙŠØ¨ÙŠ</span>
                </div>
            </header>

            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ -->
            <section class="form-section">
                <input
                    type="text"
                    id="studentNameInput"
                    placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨"
                    autocomplete="off"
                />
                <button class="btn btn-primary" id="addStudentBtn">
                    â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨
                </button>
            </section>

            <!-- Ø±Ø³Ø§Ù„Ø© Ø­Ø§Ù„Ø© -->
            <div class="status-bar" id="statusBar"></div>

            <!-- Ø¬Ø¯ÙˆÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨ -->
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                            <th>Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ØªÙ†Ø¯ (Firestore)</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody">
                        <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </tbody>
                </table>
            </div>

            <div class="empty-state" id="emptyState" style="display: none;">
                Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø§Ø¨ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†. Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø·Ø§Ù„Ø¨ ğŸ˜Š
            </div>

            <div class="footer-note">
                Ø±ÙÙŠÙ‚ÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ â€“ Demo / Firebase Firestore â€“ Students Collection
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -->
    <div class="modal-backdrop" id="editModalBackdrop">
        <div class="modal">
            <div class="modal-header">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</div>
            <div>
                <input type="text" id="editStudentNameInput" style="width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid #d1d5db; outline: none; font-size: 14px;" />
            </div>
            <div class="modal-actions">
                <button class="btn btn-ghost" id="cancelEditBtn">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" id="saveEditBtn">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
            </div>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Ù„Ù…Ø´Ø±ÙˆØ¹ rafiqi-university
        const firebaseConfig = {
          apiKey: "AIzaSyBhfq7_xROsUdZn9toGTSeavzyu2uTaOmM",
          authDomain: "rafiqi-university.firebaseapp.com",
          projectId: "rafiqi-university",
          storageBucket: "rafiqi-university.firebasestorage.app",
          messagingSenderId: "772477171251",
          appId: "1:772477171251:web:cef7986472c0632e765546"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Ù…Ø±Ø§Ø¬Ø¹ Ù„Ù„Ø¹Ù†Ø§ØµØ±
        const studentNameInput = document.getElementById("studentNameInput");
        const addStudentBtn = document.getElementById("addStudentBtn");
        const studentsTableBody = document.getElementById("studentsTableBody");
        const statusBar = document.getElementById("statusBar");
        const emptyState = document.getElementById("emptyState");

        // Ø¹Ù†Ø§ØµØ± Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        const editModalBackdrop = document.getElementById("editModalBackdrop");
        const editStudentNameInput = document.getElementById("editStudentNameInput");
        const cancelEditBtn = document.getElementById("cancelEditBtn");
        const saveEditBtn = document.getElementById("saveEditBtn");

        let editingStudentId = null; // Ù„ØªØ®Ø²ÙŠÙ† ID Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø§Ø±ÙŠ ØªØ¹Ø¯ÙŠÙ„Ù‡

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø­Ø§Ù„Ø©
        function setStatus(message, type = "normal") {
            if (!message) {
                statusBar.innerHTML = "";
                return;
            }
            if (type === "ok") {
                statusBar.innerHTML = `<span class="ok">âœ… ${message}</span>`;
            } else if (type === "error") {
                statusBar.innerHTML = `<span class="error">âŒ ${message}</span>`;
            } else {
                statusBar.innerHTML = message;
            }
        }

        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        function openEditModal(docId, currentName) {
            editingStudentId = docId;
            editStudentNameInput.value = currentName || "";
            editModalBackdrop.style.display = "flex";
            editStudentNameInput.focus();
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        function closeEditModal() {
            editingStudentId = null;
            editModalBackdrop.style.display = "none";
        }

        cancelEditBtn.addEventListener("click", closeEditModal);

        saveEditBtn.addEventListener("click", async () => {
            const newName = editStudentNameInput.value.trim();
            if (!editingStudentId || newName === "") {
                setStatus("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ØµØ§Ù„Ø­ Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸.", "error");
                return;
            }

            try {
                await db.collection("students").doc(editingStudentId).update({
                    name: newName
                });
                setStatus("ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­.", "ok");
                closeEditModal();
            } catch (err) {
                console.error(err);
                setStatus("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨: " + err.message, "error");
            }
        });

        // Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
        addStudentBtn.addEventListener("click", async () => {
            const name = studentNameInput.value.trim();
            if (name === "") {
                setStatus("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£ÙˆÙ„Ø§Ù‹.", "error");
                return;
            }

            try {
                await db.collection("students").add({
                    name: name,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                setStatus("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­.", "ok");
                studentNameInput.value = "";
                studentNameInput.focus();
            } catch (err) {
                console.error(err);
                setStatus("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨: " + err.message, "error");
            }
        });

        // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨Ø´ÙƒÙ„ Ø­ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… onSnapshot
        db.collection("students")
          .orderBy("createdAt", "asc")
          .onSnapshot((snapshot) => {
            studentsTableBody.innerHTML = "";
            let index = 1;

            if (snapshot.empty) {
                emptyState.style.display = "block";
            } else {
                emptyState.style.display = "none";
            }

            snapshot.forEach((doc) => {
                const data = doc.data();
                const tr = document.createElement("tr");

                tr.innerHTML = `
                    <td>${index}</td>
                    <td>
                        ${data.name || "-"}
                        <span class="tag">Ø·Ø§Ù„Ø¨</span>
                    </td>
                    <td style="font-size: 11px; color: #9ca3af;">${doc.id}</td>
                    <td>
                        <button class="btn btn-ghost" data-edit="${doc.id}" data-name="${data.name || ""}">
                            âœï¸ ØªØ¹Ø¯ÙŠÙ„
                        </button>
                        <button class="btn btn-danger" data-delete="${doc.id}">
                            ğŸ—‘ Ø­Ø°Ù
                        </button>
                    </td>
                `;

                studentsTableBody.appendChild(tr);
                index++;
            });

            // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù Ø¨Ø¹Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            document.querySelectorAll("[data-edit]").forEach((btn) => {
                btn.addEventListener("click", (e) => {
                    const id = e.currentTarget.getAttribute("data-edit");
                    const currentName = e.currentTarget.getAttribute("data-name");
                    openEditModal(id, currentName);
                });
            });

            document.querySelectorAll("[data-delete]").forEach((btn) => {
                btn.addEventListener("click", async (e) => {
                    const id = e.currentTarget.getAttribute("data-delete");
                    const confirmDelete = confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ");
                    if (!confirmDelete) return;

                    try {
                        await db.collection("students").doc(id).delete();
                        setStatus("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­.", "ok");
                    } catch (err) {
                        console.error(err);
                        setStatus("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨: " + err.message, "error");
                    }
                });
            });

        }, (error) => {
            console.error(error);
            setStatus("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨: " + error.message, "error");
        });
    </script>
</body>
</html>
